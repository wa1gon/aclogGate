
import { AcLogConn } from './aclogApi/AcLogConn';
import { LogGateResp } from './logGateModels/LogGateResp';

var http = require('http');
var url = require('url');
const querystring = require('querystring');

export class HttpServer {
    private readonly listAllPath = "/loggate/v1/listall";

    private port: number;
    private hostname: string;

    constructor(p: number = 3000, h: string = "localhost") {
        this.port = p;
        this.hostname = h;
    }

    public createServer() {
        const server = http.createServer((req, res) => {
            let q = url.parse(req.url);

            switch (q.pathname) {
                case this.listAllPath:
                    console.log(q.query);
                    let qObj = querystring.parse(q.query);

                    let count: number = Number.parseInt(qObj.count);
                    console.log("%d",count);
                    this.listDataBase(count, req, res);

            }
            console.log(q.pathname);
        });

        server.listen(this.port);
    }



    //let acConn = new AcLogConn();

    private listDataBase(limit: number,req,res) {


        let count: number;
        let acConn: AcLogConn = new AcLogConn();
        acConn.port = 1100;
        acConn.host = "192.168.1.101";

        acConn.listAllDatabase(limit,  req, res);
        // result: Array<LogGateResp>) => {
        //     console.log("got list all data resp ")
        //     //res.json(result);
        //     res.writeHead(200, { 'Content-type': 'application/json' });
        //     res.write(JSON.stringify(result));  
        //     res.end();
        //     console.log("after sending results");
        // });
    }
}




